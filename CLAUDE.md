# Claude 协作准则

本文档定义与 Claude 协作开发的通用准则，适用于所有 AI 辅助开发项目。

## 1. 开发方法论

### 1.1 测试驱动开发 (TDD)
- 先编写单元测试，再实现功能
- 每个模块需有对应测试文件
- 测试覆盖率目标 > 80%

### 1.2 模块化设计
- 标准化接口，降低耦合
- 单一职责原则
- 优先使用官方/成熟库

### 1.3 迭代开发
- 小步快跑，频繁验证
- 遇到阻塞时及时调整方案
- 避免过度设计

## 2. 协作约定

### 2.1 阶段验收
- 每完成一个阶段需运行全量单元测试
- 测试通过后再进入下一阶段
- 验收命令示例：`pytest tests/ -v`

### 2.2 问题记录
- 发现问题需更新 `codex.MD`
- 记录格式：问题描述 → 根因分析 → 解决方案
- 标注日期和状态（待处理/已解决）

### 2.3 消融实验输出规范
- 所有消融实验脚本在分析阶段必须生成对比文档与可视化图表
- 对比文档与可视化输出统一写入 `docs/`

### 2.4 依赖管理
- 需要安装新依赖时先征询用户
- 优先使用已有环境中的包
- 记录依赖变更到 `requirements.txt`

### 2.5 计划调整
- 重大调整需更新 `DEVELOPMENT_PLAN.md`
- 说明调整原因和影响
- 征询用户确认后再执行

## 3. 环境规范

### 3.1 conda 环境
- 本项目使用 `cv` conda 环境
- 训练脚本使用 Python 脚本而非 shell 脚本，便于用户手动执行
- 用户手动执行：`conda activate cv && python scripts/xxx.py`

### 3.2 CUDA/GPU
- 优先使用 CUDA（可用时）
- 不可用时自动回退 CPU
- 显存不足时减小 batch size

### 3.3 依赖安装
- 网络受限时使用离线安装
- pip 失败时尝试 conda
- 记录安装问题到 `codex.MD`

## 4. 代码规范

### 4.1 命名约定
- 类名：PascalCase
- 函数/变量：snake_case
- 常量：UPPER_SNAKE_CASE

### 4.2 文档要求
- 公开接口需有 docstring
- 复杂逻辑需有注释
- 配置项需有说明

### 4.3 测试要求
- 单元测试文件命名：`test_<module>.py`
- 测试函数命名：`test_<功能描述>`
- 使用 pytest fixtures 复用测试资源

## 5. 问题处理流程

### 5.1 问题分类
- **高**：阻塞开发，需立即处理
- **中**：影响功能，需尽快处理
- **低**：优化建议，可延后处理

### 5.2 记录格式
```
## [P00X] 问题标题

**日期**: YYYY-MM-DD
**状态**: 待处理 / 已解决
**严重程度**: 高 / 中 / 低

### 问题描述
...

### 根因分析
...

### 解决方案
...
```

### 5.3 修复验证
- 修复后运行相关测试
- 确认问题不再复现
- 更新问题状态为「已解决」
